/*! For license information please see module.js.LICENSE.txt */
define(["react","d3","emotion","@grafana/ui","@grafana/data"],(function(t,e,n,a,r){return function(t){var e={};function n(a){if(e[a])return e[a].exports;var r=e[a]={i:a,l:!1,exports:{}};return t[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(a,r,function(e){return t[e]}.bind(null,r));return a},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=5)}([function(e,n){e.exports=t},function(t,n){t.exports=e},function(t,e){t.exports=n},function(t,e){t.exports=a},function(t,e){t.exports=r},function(t,e,n){"use strict";n.r(e);var a=n(4);var r=function(){return(r=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function o(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var a,r,o=n.call(t),i=[];try{for(;(void 0===e||e-- >0)&&!(a=o.next()).done;)i.push(a.value)}catch(t){r={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return i}function i(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(o(arguments[e]));return t}function s(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var l=n(0),u=n.n(l),c=n(2),p=n(3),f=n(1);var d,m,h,x,b,g,y,v,w,O,j,k=function(t){var e=t.data,n=t.styles,a=t.theme,r=t.padding,o=t.x,i=t.y,s=t.chartHeight,l=t.tooltipHandler,c=t.vitalBreakpointVal,p=t.showVitalFew,d=!1;return u.a.createElement("g",{className:"bars",transform:"translate("+r+", 0)"},e.y.map((function(t,r){var m=o(e.x[r])||0;return u.a.createElement(u.a.Fragment,null,u.a.createElement("rect",{className:n.bar,x:m,y:i(t),width:o.bandwidth(),height:s-i(t),fill:e.p[r]>c?a.palette.redBase:a.palette.greenBase,"data-label":e.tooltipLabel[r],"data-count":e.yLabel[r],"data-is-vital":e.p[r]<c,onMouseOver:l,onMouseMove:l,onMouseOut:l}),u.a.createElement(u.a.Fragment,null,e.p[r]>c&&p&&!d&&(d=!0,!0)&&u.a.createElement("line",{className:n.lineCutOff,transform:"translate(0, 0)",ref:function(t){f.select(t).attr("x1",m+o.bandwidth()/2).attr("x2",m+o.bandwidth()/2).attr("y1",0).attr("y2",s)}})))})))},E=function(t){var e=t.styles,n=t.padding,a=t.x,r=t.pathData,o=t.line,i=t.showVitalFew,s=t.cutOffXPathData;return u.a.createElement("g",{className:e.paths},u.a.createElement("path",{className:e.line,transform:"translate("+(n+a.bandwidth()/2)+", "+n+")",ref:function(t){Object(f.select)(t).datum(r).attr("d",o)}}),i&&u.a.createElement("path",{className:e.lineCutOff,transform:"translate("+(n+a.bandwidth()/2)+", "+n+")",ref:function(t){Object(f.select)(t).datum(s).attr("d",o)}}))},N=function(t){var e=t.data,n=t.styles,a=t.showBottomAxis,r=t.padding,i=t.chartHeight,s=t.chartWidth,l=t.x,c=t.y,p=t.p,d=t.pLabels,m=t.vitalBreakpointVal;return u.a.createElement("g",{className:"axis"},a&&u.a.createElement("g",{className:"axis-bottom",transform:"translate("+r+", "+i+")",ref:function(t){var n=o(e.p.filter((function(t,n){return e.p[n]<m})).sort((function(t,e){return e-t})),1)[0],a=Object(f.axisBottom)(l).tickValues(l.domain().filter((function(t,a){return e.p[a]===n||e.p.length-1===a})));Object(f.select)(t).call(a).selectAll("text").attr("y",r/2).attr("x",0).style("text-anchor","center")}}),!a&&u.a.createElement("line",{className:n.lineBottomAxis,transform:"translate("+r+", 0)",ref:function(t){Object(f.select)(t).attr("x1",0).attr("x2",s-r).attr("y1",i).attr("y2",i)}}),u.a.createElement("g",{className:"axis-left",transform:"translate("+r+", 0)",ref:function(t){Object(f.select)(t).call(Object(f.axisLeft)(c).ticks(i/30))}}),u.a.createElement("g",{className:"axis-right",transform:"translate("+(s+r)+", 0)",ref:function(t){Object(f.select)(t).call(Object(f.axisLeft)(p).ticks(4).tickFormat(d))}}))},B=function(){function t(t){var e=o(t.request.targets,1)[0].resultFormat,n=o(t.series,1)[0],a=n.fields,r=n.meta;r&&r.executedQueryString&&"time_series"!==e?(this.dataType="table",this.results=this.setTableData(a)):"time_series"===e?(this.dataType="series",this.results=this.setTimeSeriesData(t.series)):(this.dataType="series",this.results=this.setSeriesData(a))}return t.prototype.getResults=function(){return this.results},t.prototype.setTableData=function(t){var e=t.find((function(t){return"x"===t.name})),n=t.find((function(t){return"y"===t.name})),a=e.values.toArray().map((function(t,e){return""+t})),r=n.values.toArray();return this.setResults(a,r,this.sumYVals(r))},t.prototype.setSeriesData=function(t){var e=o(t,2),n=e[0],a=e[1],r=n.values.toArray().map((function(t,e){return e})),i=a.values.toArray();return this.setResults(r,i,this.sumYVals(i))},t.prototype.setTimeSeriesData=function(t){var e=this,n=t.map((function(t,n){var a=t.name;return e.stripName(a)})),a=t.map((function(t,e){var n=o(t.fields,2);return o(n[1].values.toArray(),1)[0]}));return this.setResults(n,a,this.sumYVals(a))},t.prototype.sumYVals=function(t){return t.reduce((function(t,e){return t+e}),0)},t.prototype.stripName=function(t){var e=o(t.match(/\{.*:+(.*)\}/),2),n=e[0],a=e[1];return a?a.trim():n?n.trim():t},t.prototype.setResults=function(t,e,n){return this.results=e.map((function(e,n){return{i:n,x:t[n],y:e}})).sort((function(t,e){return e.y-t.y})).reduce((function(t,a,o){var s,l=100*a.y/n,u=((null===(s=t)||void 0===s?void 0:s.p[o-1])?t.p[o-1]:0)+l,c=o===e.length-1?u.toFixed(0)+" %":u.toFixed(2)+" %",p=l.toFixed(2)+" %";return r(r({},t),{x:i(t.x,[c]),y:i(t.y,[a.y]),p:i(t.p,[u]),yLabel:i(t.yLabel,[a.y.toFixed(2)]),tooltipLabel:i(t.tooltipLabel,[p])})}),{x:[],y:[],p:[],yLabel:[],tooltipLabel:[]}),this.results},t}(),V=Object(p.stylesFactory)((function(){var t=Object(p.useTheme)();return{wrapper:Object(c.css)(d||(d=s(["\n      position: relative;\n    "],["\n      position: relative;\n    "]))),svg:Object(c.css)(m||(m=s(["\n      position: absolute;\n      top: 0;\n      left: 0;\n    "],["\n      position: absolute;\n      top: 0;\n      left: 0;\n    "]))),tooltipContainer:Object(c.css)(h||(h=s(["\n      position: fixed;\n      z-index: 100;\n      min-width: 20vw;\n      display: flex;\n      top: -100vh;\n      left: -100vw;\n    "],["\n      position: fixed;\n      z-index: 100;\n      min-width: 20vw;\n      display: flex;\n      top: -100vh;\n      left: -100vw;\n    "]))),tooltip:Object(c.css)(x||(x=s(["\n      position: absolute;\n      bottom: 0;\n      left: 0;\n      border: 1px solid ",";\n      padding: 4px 10px;\n      max-width: 100%;\n      color: white;\n\n      strong {\n        position: absolute;\n        top: -1px;\n        left: 100%;\n        padding: 4px;\n        bottom: -1px;\n        min-width: 50px;\n        text-align: center;\n        background: inherit;\n        border: 1px solid ",";\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 1.4rem;\n      }\n    "],["\n      position: absolute;\n      bottom: 0;\n      left: 0;\n      border: 1px solid ",";\n      padding: 4px 10px;\n      max-width: 100%;\n      color: white;\n\n      strong {\n        position: absolute;\n        top: -1px;\n        left: 100%;\n        padding: 4px;\n        bottom: -1px;\n        min-width: 50px;\n        text-align: center;\n        background: inherit;\n        border: 1px solid ",";\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 1.4rem;\n      }\n    "])),t.colors.border2,t.colors.border2),textBox:Object(c.css)(b||(b=s(["\n      position: absolute;\n      bottom: 0;\n      left: 0;\n      padding: 10px;\n    "],["\n      position: absolute;\n      bottom: 0;\n      left: 0;\n      padding: 10px;\n    "]))),bar:Object(c.css)(g||(g=s(["\n      cursor: pointer;\n    "],["\n      cursor: pointer;\n    "]))),line:Object(c.css)(y||(y=s(["\n      fill: none;\n      stroke: ",";\n      stroke-width: 2px;\n    "],["\n      fill: none;\n      stroke: ",";\n      stroke-width: 2px;\n    "])),t.isDark?"rgba(255,255,255,.5)":"rgba(0,0,0,.5)"),lineCutOff:Object(c.css)(v||(v=s(["\n      fill: none;\n      stroke: rgba(255, 0, 0, 0.75);\n      stroke-width: 2px;\n      stroke-dasharray: 5px;\n    "],["\n      fill: none;\n      stroke: rgba(255, 0, 0, 0.75);\n      stroke-width: 2px;\n      stroke-dasharray: 5px;\n    "]))),lineBottomAxis:Object(c.css)(w||(w=s(["\n      fill: none;\n      stroke: rgba(255, 255, 255, 1);\n      stroke-width: 0.75px;\n    "],["\n      fill: none;\n      stroke: rgba(255, 255, 255, 1);\n      stroke-width: 0.75px;\n    "]))),paths:Object(c.css)(O||(O=s(["\n      position: relative;\n    "],["\n      position: relative;\n    "])))}}));n.d(e,"plugin",(function(){return S}));var S=new a.PanelPlugin((function(t){var e=t.options,n=t.data,a=t.width,o=t.height;if(!n||!n.series.length)return u.a.createElement(u.a.Fragment,null,"No Data");var i=Object(p.useTheme)(),d=V(),m=Object(l.useRef)(null),h=Object(l.useRef)(null),x=new B(n).getResults(),b={theme:i,tooltipRef:m,tooltipContentRef:h},g=function(t,e,n){var a=e.options,r=e.width,o=e.height,i=n.theme,s=n.tooltipRef,l=n.tooltipContentRef,u=a.vitalBreakpointVal,c=f.max(t.y)||0,p=f.min(t.y)||0,d=o-40,m=r-40,h=f.scaleBand().range([0,m-20]).padding(a.barPadding),x=f.scaleLinear().range([d,0]),b=f.scaleLinear().range([d,0]),g=f.line().x((function(e,n){return h(t.x[n])||0})).y((function(t,e){return d-t.p*d/100-20})),y=t.p.map((function(e,n){return{x:t.x[n]||"",p:e||0}}))||null,v=t.p.map((function(e,n){return{x:t.x[n]||"",p:100-u}}))||null,w=t.p.map((function(t,e){return{x:e,p:0}})),O=t.p[0]/t.p.length;return h.domain(t.x),x.domain([p-O,c+O]),{padding:20,x:h,y:x,p:b,chartHeight:d,chartWidth:m,tooltipHandler:function(t){var e,n=(s||{current:null}).current,a=(l||{current:null}).current,r=(null===(e=t.currentTarget)||void 0===e?void 0:e.dataset)||{},o=r.label,u=r.isVital,c=r.count,p=!!["mouseover","mousemove"].includes(t.type);n&&(f.select(n).style("opacity",p?.9:0).style("left",t.pageX+"px").style("top",t.pageY-28+"px"),f.select(a).style("background","true"===u?i.palette.greenBase:i.palette.redBase).html(o+"<strong>"+c+"</strong>"))},line:g,pathData:y,cutOffXPathData:v,bottomLineData:w,pLabels:function(t,e){return 0!==e&&t&&t?100*t+" %":""},Component:k}}(x,{options:e,width:a,height:o},b),y=r(r(r({data:x,styles:d},e),b),g),v=g.Component;return u.a.createElement("div",{className:Object(c.cx)(d.wrapper,Object(c.css)(j||(j=s(["\n          width: ","px;\n          height: ","px;\n        "],["\n          width: ","px;\n          height: ","px;\n        "])),a,o))},u.a.createElement("div",{ref:m,className:d.tooltipContainer},u.a.createElement("div",{ref:h,className:d.tooltip})),u.a.createElement("svg",{className:d.svg,width:a,height:o,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 "+a+" "+o},u.a.createElement("g",{transform:"translate("+g.padding+", "+g.padding+")",className:"wrapper"},u.a.createElement(v,r({},y)),u.a.createElement(E,r({},y)),u.a.createElement(N,r({},y)))))})).setPanelOptions((function(t){return t.addBooleanSwitch({path:"showBottomAxis",name:"Show bottom axis?",defaultValue:!1}).addBooleanSwitch({path:"showVitalFew",name:"Show vital few line?",defaultValue:!0}).addNumberInput({path:"vitalBreakpointVal",name:"Vital few value (%)",defaultValue:80}).addNumberInput({path:"barPadding",name:"Bar padding",defaultValue:.2,settings:{min:0,max:1}})}))}])}));
//# sourceMappingURL=module.js.map