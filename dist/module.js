/*! For license information please see module.js.LICENSE.txt */
define(["react","d3","emotion","@grafana/ui","@grafana/data"],(function(t,e,n,r,a){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var a=e[r]={i:r,l:!1,exports:{}};return t[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(r,a,function(e){return t[e]}.bind(null,a));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=5)}([function(e,n){e.exports=t},function(t,n){t.exports=e},function(t,e){t.exports=n},function(t,e){t.exports=r},function(t,e){t.exports=a},function(t,e,n){"use strict";n.r(e);var r=n(4);var a=function(){return(a=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)};function o(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,a,o=n.call(t),i=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(t){a={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i}function i(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(o(arguments[e]));return t}function s(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var l,u,c,p,f,d,m,x,h,b,g=n(0),y=n.n(g),v=n(2),w=n(1),O=n(3),j=function(){function t(t){var e=o(t.request.targets,1)[0].resultFormat,n=o(t.series,1)[0],r=n.fields,a=n.meta;a&&a.executedQueryString&&"time_series"!==e?(this.dataType="table",this.results=this.setTableData(r)):"time_series"===e?(this.dataType="series",this.results=this.setTimeSeriesData(t.series)):(this.dataType="series",this.results=this.setSeriesData(r))}return t.prototype.getResults=function(){return this.results},t.prototype.setTableData=function(t){var e=t.find((function(t){return"x"===t.name})),n=t.find((function(t){return"y"===t.name})),r=e.values.toArray().map((function(t,e){return""+t})),a=n.values.toArray();return this.setResults(r,a,this.sumYVals(a))},t.prototype.setSeriesData=function(t){var e=o(t,2),n=e[0],r=e[1],a=n.values.toArray().map((function(t,e){return"T"+(e+1)})),i=r.values.toArray();return this.setResults(a,i,this.sumYVals(i))},t.prototype.setTimeSeriesData=function(t){var e=this,n=t.map((function(t,n){var r=t.name;return e.stripName(r)})),r=t.map((function(t,e){var n=o(t.fields,2);return o(n[1].values.toArray(),1)[0]}));return this.setResults(n,r,this.sumYVals(r))},t.prototype.sumYVals=function(t){return t.reduce((function(t,e){return t+e}),0)},t.prototype.stripName=function(t){var e=o(t.match(/\{.*:+(.*)\}/),2),n=e[0],r=e[1];return r?r.trim():n?n.trim():t},t.prototype.setResults=function(t,e,n){return this.results=e.map((function(e,n){return{x:t[n],y:e}})).sort((function(t,e){return e.y-t.y})).reduce((function(t,e,r){var o;return a(a({},t),{x:i(t.x,[e.x]),y:i(t.y,[e.y]),p:i(t.p,[((null===(o=t)||void 0===o?void 0:o.p[r-1])?t.p[r-1]:0)+100*e.y/n])})}),{x:[],y:[],p:[]}),this.results},t}(),k=Object(O.stylesFactory)((function(){var t=Object(O.useTheme)();return{wrapper:Object(v.css)(u||(u=s(["\n      position: relative;\n    "],["\n      position: relative;\n    "]))),svg:Object(v.css)(c||(c=s(["\n      position: absolute;\n      top: 0;\n      left: 0;\n    "],["\n      position: absolute;\n      top: 0;\n      left: 0;\n    "]))),tooltipContainer:Object(v.css)(p||(p=s(["\n      position: fixed;\n      z-index: 100;\n      min-width: 20vw;\n      display: flex;\n    "],["\n      position: fixed;\n      z-index: 100;\n      min-width: 20vw;\n      display: flex;\n    "]))),tooltip:Object(v.css)(f||(f=s(["\n      position: absolute;\n      bottom: 0;\n      left: 0;\n      border: 1px solid ",";\n      padding: 4px 10px;\n      max-width: 100%;\n      color: white;\n\n      strong {\n        position: absolute;\n        top: -1px;\n        left: 100%;\n        padding: 4px;\n        bottom: -1px;\n        min-width: 50px;\n        text-align: center;\n        background: inherit;\n        border: 1px solid ",";\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 1.4rem;\n      }\n    "],["\n      position: absolute;\n      bottom: 0;\n      left: 0;\n      border: 1px solid ",";\n      padding: 4px 10px;\n      max-width: 100%;\n      color: white;\n\n      strong {\n        position: absolute;\n        top: -1px;\n        left: 100%;\n        padding: 4px;\n        bottom: -1px;\n        min-width: 50px;\n        text-align: center;\n        background: inherit;\n        border: 1px solid ",";\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 1.4rem;\n      }\n    "])),t.colors.border2,t.colors.border2),textBox:Object(v.css)(d||(d=s(["\n      position: absolute;\n      bottom: 0;\n      left: 0;\n      padding: 10px;\n    "],["\n      position: absolute;\n      bottom: 0;\n      left: 0;\n      padding: 10px;\n    "]))),bar:Object(v.css)(m||(m=s(["\n      cursor: pointer;\n    "],["\n      cursor: pointer;\n    "]))),line:Object(v.css)(x||(x=s(["\n      fill: none;\n      stroke: ",";\n      stroke-width: 2px;\n    "],["\n      fill: none;\n      stroke: ",";\n      stroke-width: 2px;\n    "])),t.isDark?"rgba(255,255,255,.5)":"rgba(0,0,0,.5)"),lineCutOff:Object(v.css)(h||(h=s(["\n      fill: none;\n      stroke: rgba(255, 0, 0, 0.75);\n      stroke-width: 2px;\n      stroke-dasharray: 5px;\n    "],["\n      fill: none;\n      stroke: rgba(255, 0, 0, 0.75);\n      stroke-width: 2px;\n      stroke-dasharray: 5px;\n    "]))),paths:Object(v.css)(b||(b=s(["\n      position: relative;\n    "],["\n      position: relative;\n    "])))}}));n.d(e,"plugin",(function(){return E}));var E=new r.PanelPlugin((function(t){var e=t.options,n=t.data,r=t.width,a=t.height;if(!n||!n.series.length)return y.a.createElement(y.a.Fragment,null,"No Data");var o=Object(O.useTheme)(),i=k(),u=Object(g.useRef)(null),c=Object(g.useRef)(null),p=e.vitalBreakpointVal,f=e.showVitalFew,d=e.showBottomAxis,m=new j(n).getResults(),x=w.max(m.y)||0,h=w.min(m.y)||0,b=a-40,E=r-40,N=w.scaleBand().rangeRound([0,E]).padding(e.barPadding),B=w.scaleLinear().rangeRound([b,0]),S=w.scaleLinear().rangeRound([b,0]),P=w.scaleBand().rangeRound([0,E]).padding(e.barPadding),V=w.line().x((function(t,e){return P(m.x[e])||0})).y((function(t,e){return b-t.p*b/100-20})),T=function(t,e){return 0!==e&&t&&t?100*t+"%":""},R=m.p.map((function(t,e){return{x:m.x[e]||"",p:t||0}}))||null,D=m.p.map((function(t,e){return{x:m.x[e]||"",p:p}}))||null,F=m.p[0]/m.p.length,M=!1,_=function(t){var e,n=(u||{current:null}).current,r=(c||{current:null}).current,a=(null===(e=t.currentTarget)||void 0===e?void 0:e.dataset)||{},i=a.label,s=a.isVital,l=a.count,p=!!["mouseover","mousemove"].includes(t.type);n&&(w.select(n).style("opacity",p?.9:0).style("left",t.pageX+"px").style("top",t.pageY-28+"px"),w.select(r).style("background","true"===s?o.palette.greenBase:o.palette.redBase).html(i+"<strong>"+l+"</strong>"))};return N.domain(m.x),B.domain([h-F,x+F]),P.domain(m.x),y.a.createElement("div",{className:Object(v.cx)(i.wrapper,Object(v.css)(l||(l=s(["\n          width: ","px;\n          height: ","px;\n        "],["\n          width: ","px;\n          height: ","px;\n        "])),r,a))},y.a.createElement("div",{ref:u,className:i.tooltipContainer},y.a.createElement("div",{ref:c,className:i.tooltip})),y.a.createElement("svg",{className:i.svg,width:r,height:a,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 "+r+" "+a},y.a.createElement("g",{transform:"translate(20, 20)",className:"wrapper"},y.a.createElement("g",{className:"bars",transform:"translate(20, 0)"},m.y.map((function(t,e){var n=N(m.x[e])||0;return y.a.createElement(y.a.Fragment,null,y.a.createElement("rect",{className:i.bar,x:n,y:B(t),width:N.bandwidth(),height:b-B(t),fill:m.p[e]>p?o.palette.redBase:o.palette.greenBase,"data-label":m.x[e],"data-count":t,"data-is-vital":m.p[e]<p,onMouseOver:_,onMouseMove:_,onMouseOut:_}),y.a.createElement(y.a.Fragment,null,m.p[e]>p&&f&&!M&&(M=!0,!0)&&y.a.createElement("line",{className:i.lineCutOff,transform:"translate(0, 0)",ref:function(t){w.select(t).attr("x1",n+N.bandwidth()/2).attr("x2",n+N.bandwidth()/2).attr("y1",0).attr("y2",b)}})))}))),y.a.createElement("g",{className:i.paths},y.a.createElement("path",{className:i.line,transform:"translate("+(20+N.bandwidth()/2)+", 20)",ref:function(t){w.select(t).datum(R).attr("d",(function(t){return V(t)}))}}),f&&y.a.createElement("path",{className:i.lineCutOff,transform:"translate("+(20+N.bandwidth()/2)+", 20)",ref:function(t){w.select(t).datum(D).attr("d",(function(t){return V(t)}))}})),y.a.createElement("g",{className:"axis"},d&&y.a.createElement("g",{transform:"translate(20, "+b+")",ref:function(t){w.select(t).call(w.axisBottom(N))}}),y.a.createElement("g",{transform:"translate(20, 0)",ref:function(t){w.select(t).call(w.axisLeft(B))}}),y.a.createElement("g",{transform:"translate("+(E+20)+", 0)",ref:function(t){w.select(t).call(w.axisLeft(S).ticks(5).tickFormat(T))}})))))})).setPanelOptions((function(t){return t.addBooleanSwitch({path:"showBottomAxis",name:"Show bottom axis?",defaultValue:!1}).addBooleanSwitch({path:"showVitalFew",name:"Show vital few line?",defaultValue:!0}).addNumberInput({path:"vitalBreakpointVal",name:"Vital few value (%)",defaultValue:80}).addNumberInput({path:"barPadding",name:"Bar padding",defaultValue:.2})}))}])}));
//# sourceMappingURL=module.js.map